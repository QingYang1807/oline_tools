<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>è½»é‡åŒ–æ—¥å† Â· å·¥å…·ç®±</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <meta name="color-scheme" content="light dark">
  <style>
    .calendar-container {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .calendar-nav {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .calendar-nav button {
      padding: 8px 12px;
      font-size: 14px;
    }
    
    .current-month {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--fg);
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background: var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    
    .calendar-day-header {
      background: var(--panel-bg);
      padding: 12px 8px;
      text-align: center;
      font-weight: 600;
      color: var(--muted);
      font-size: 14px;
    }
    
    .calendar-day {
      background: var(--card);
      min-height: 80px;
      padding: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .calendar-day:hover {
      background: var(--panel-bg);
    }
    
    .calendar-day.other-month {
      color: var(--muted);
      opacity: 0.5;
    }
    
    .calendar-day.today {
      background: var(--accent);
      color: white;
    }
    
    .calendar-day.today:hover {
      background: var(--accent-hover);
    }
    
    .day-number {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .day-events {
      font-size: 12px;
      line-height: 1.2;
    }
    
    .event-dot {
      display: inline-block;
      width: 6px;
      height: 6px;
      background: var(--accent);
      border-radius: 50%;
      margin-right: 4px;
    }
    
    .calendar-day.today .event-dot {
      background: white;
    }
    
    .plans-panel {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .plans-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .selected-date {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--fg);
    }
    
    .plans-input {
      width: 100%;
      min-height: 100px;
      padding: 16px;
      border: 2px solid var(--border);
      border-radius: 12px;
      background: var(--panel-bg);
      color: var(--fg);
      font-family: inherit;
      font-size: 14px;
      line-height: 1.5;
      resize: vertical;
      transition: border-color 0.2s ease;
    }
    
    .plans-input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }
    
    .plans-actions {
      display: flex;
      gap: 12px;
      margin-top: 16px;
    }
    
    .plans-actions button {
      flex: 1;
    }
    
    .plans-actions button.secondary {
      background: transparent;
      color: var(--accent);
      border-color: var(--accent);
    }
    
    .plans-actions button.secondary:hover {
      background: var(--accent);
      color: white;
    }
    
    .quick-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      flex-wrap: wrap;
    }
    
    .quick-action {
      padding: 6px 12px;
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      color: var(--muted);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .quick-action:hover {
      background: var(--accent);
      color: white;
      border-color: var(--accent);
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-top: 24px;
    }
    
    .stat-card {
      background: var(--panel-bg);
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 8px;
    }
    
    .stat-label {
      color: var(--muted);
      font-size: 14px;
    }
    
    @media (max-width: 768px) {
      .calendar-container,
      .plans-panel {
        padding: 16px;
      }
      
      .calendar-header {
        flex-direction: column;
        gap: 16px;
        align-items: stretch;
      }
      
      .calendar-nav {
        justify-content: center;
      }
      
      .calendar-day {
        min-height: 60px;
        padding: 6px;
      }
      
      .day-number {
        font-size: 14px;
      }
      
      .day-events {
        font-size: 11px;
      }
      
      .stats {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <div style="display: flex; align-items: center; gap: 16px;">
        <a href="../index.html" class="back-link">â† è¿”å›å·¥å…·ç®±</a>
        <h1 class="site-title">ğŸ“… è½»é‡åŒ–æ—¥å†</h1>
      </div>
      <p class="site-subtitle">ç®€æ´çš„æ—¥å†åº”ç”¨ï¼Œæ”¯æŒåœ¨ç½‘é¡µä¸­å†™ä¸‹è®¡åˆ’</p>
    </div>
  </header>

  <main class="container">
    <div class="calendar-container">
      <div class="calendar-header">
        <div class="calendar-nav">
          <button onclick="previousMonth()">â† ä¸Šæœˆ</button>
          <button onclick="goToToday()">ä»Šå¤©</button>
          <button onclick="nextMonth()">ä¸‹æœˆ â†’</button>
        </div>
        <div class="current-month" id="currentMonth"></div>
      </div>
      
      <div class="calendar-grid" id="calendarGrid">
        <!-- æ—¥å†å†…å®¹å°†é€šè¿‡JavaScriptç”Ÿæˆ -->
      </div>
    </div>

    <div class="plans-panel">
      <div class="plans-header">
        <div class="selected-date" id="selectedDate">é€‰æ‹©æ—¥æœŸ</div>
        <div id="dateInfo"></div>
      </div>
      
      <textarea 
        class="plans-input" 
        id="plansInput" 
        placeholder="åœ¨è¿™é‡Œå†™ä¸‹ä½ çš„è®¡åˆ’..."
      ></textarea>
      
      <div class="plans-actions">
        <button onclick="savePlans()">ğŸ’¾ ä¿å­˜è®¡åˆ’</button>
        <button class="secondary" onclick="clearPlans()">ğŸ—‘ï¸ æ¸…ç©º</button>
      </div>
      
      <div class="quick-actions">
        <span class="quick-action" onclick="addQuickPlan('å¼€ä¼š')">å¼€ä¼š</span>
        <span class="quick-action" onclick="addQuickPlan('å†™ä»£ç ')">å†™ä»£ç </span>
        <span class="quick-action" onclick="addQuickPlan('å­¦ä¹ ')">å­¦ä¹ </span>
        <span class="quick-action" onclick="addQuickPlan('è¿åŠ¨')">è¿åŠ¨</span>
        <span class="quick-action" onclick="addQuickPlan('ä¼‘æ¯')">ä¼‘æ¯</span>
        <span class="quick-action" onclick="addQuickPlan('è´­ç‰©')">è´­ç‰©</span>
      </div>
    </div>

    <div class="stats">
      <div class="stat-card">
        <div class="stat-number" id="totalPlans">0</div>
        <div class="stat-label">æ€»è®¡åˆ’æ•°</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="thisMonthPlans">0</div>
        <div class="stat-label">æœ¬æœˆè®¡åˆ’</div>
      </div>
      <div class="stat-card">
        <div class="stat-number" id="completedPlans">0</div>
        <div class="stat-label">å·²å®Œæˆ</div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <span>Â© <span id="year"></span> å·¥å…·ç®±</span>
    </div>
  </footer>

  <script>
    // å…¨å±€å˜é‡
    let currentDate = new Date();
    let selectedDate = new Date();
    let plans = {};

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('year').textContent = new Date().getFullYear();
      loadPlans();
      renderCalendar();
      updateStats();
    });

    // åŠ è½½è®¡åˆ’æ•°æ®
    function loadPlans() {
      const saved = localStorage.getItem('calendar_plans');
      if (saved) {
        plans = JSON.parse(saved);
      }
    }

    // ä¿å­˜è®¡åˆ’æ•°æ®
    function savePlans() {
      const dateKey = formatDateKey(selectedDate);
      const plansText = document.getElementById('plansInput').value.trim();
      
      if (plansText) {
        plans[dateKey] = {
          text: plansText,
          timestamp: Date.now(),
          completed: false
        };
      } else {
        delete plans[dateKey];
      }
      
      localStorage.setItem('calendar_plans', JSON.stringify(plans));
      renderCalendar();
      updateStats();
      
      // æ˜¾ç¤ºä¿å­˜æˆåŠŸæç¤º
      const button = document.querySelector('.plans-actions button');
      const originalText = button.textContent;
      button.textContent = 'âœ… å·²ä¿å­˜';
      button.style.background = '#10b981';
      button.style.borderColor = '#10b981';
      
      setTimeout(() => {
        button.textContent = originalText;
        button.style.background = '';
        button.style.borderColor = '';
      }, 2000);
    }

    // æ¸…ç©ºè®¡åˆ’
    function clearPlans() {
      if (confirm('ç¡®å®šè¦æ¸…ç©ºè¿™ä¸ªæ—¥æœŸçš„æ‰€æœ‰è®¡åˆ’å—ï¼Ÿ')) {
        document.getElementById('plansInput').value = '';
        const dateKey = formatDateKey(selectedDate);
        delete plans[dateKey];
        localStorage.setItem('calendar_plans', JSON.stringify(plans));
        renderCalendar();
        updateStats();
      }
    }

    // æ·»åŠ å¿«é€Ÿè®¡åˆ’
    function addQuickPlan(planText) {
      const input = document.getElementById('plansInput');
      const currentValue = input.value.trim();
      if (currentValue) {
        input.value = currentValue + '\nâ€¢ ' + planText;
      } else {
        input.value = 'â€¢ ' + planText;
      }
      input.focus();
    }

    // æ¸²æŸ“æ—¥å†
    function renderCalendar() {
      const year = currentDate.getFullYear();
      const month = currentDate.getMonth();
      
      // æ›´æ–°æœˆä»½æ˜¾ç¤º
      const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 
                         'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];
      document.getElementById('currentMonth').textContent = `${year}å¹´ ${monthNames[month]}`;
      
      // ç”Ÿæˆæ—¥å†ç½‘æ ¼
      const grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';
      
      // æ·»åŠ æ˜ŸæœŸæ ‡é¢˜
      const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
      weekdays.forEach(day => {
        const dayHeader = document.createElement('div');
        dayHeader.className = 'calendar-day-header';
        dayHeader.textContent = day;
        grid.appendChild(dayHeader);
      });
      
      // è®¡ç®—æ—¥å†æ•°æ®
      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startDate = new Date(firstDay);
      startDate.setDate(startDate.getDate() - firstDay.getDay());
      
      // ç”Ÿæˆæ—¥æœŸå•å…ƒæ ¼
      for (let i = 0; i < 42; i++) {
        const date = new Date(startDate);
        date.setDate(startDate.getDate() + i);
        
        const dayCell = document.createElement('div');
        dayCell.className = 'calendar-day';
        
        // åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰æœˆä»½
        if (date.getMonth() !== month) {
          dayCell.classList.add('other-month');
        }
        
        // åˆ¤æ–­æ˜¯å¦æ˜¯ä»Šå¤©
        const today = new Date();
        if (date.toDateString() === today.toDateString()) {
          dayCell.classList.add('today');
        }
        
        // åˆ¤æ–­æ˜¯å¦æ˜¯é€‰ä¸­çš„æ—¥æœŸ
        if (date.toDateString() === selectedDate.toDateString()) {
          dayCell.style.border = '2px solid var(--accent)';
        }
        
        // æ·»åŠ æ—¥æœŸæ•°å­—
        const dayNumber = document.createElement('div');
        dayNumber.className = 'day-number';
        dayNumber.textContent = date.getDate();
        dayCell.appendChild(dayNumber);
        
        // æ·»åŠ è®¡åˆ’æŒ‡ç¤ºå™¨
        const dateKey = formatDateKey(date);
        if (plans[dateKey] && plans[dateKey].text) {
          const eventDot = document.createElement('div');
          eventDot.className = 'event-dot';
          dayCell.appendChild(eventDot);
          
          const dayEvents = document.createElement('div');
          dayEvents.className = 'day-events';
          const planText = plans[dateKey].text;
          const shortText = planText.length > 20 ? planText.substring(0, 20) + '...' : planText;
          dayEvents.textContent = shortText;
          dayCell.appendChild(dayEvents);
        }
        
        // æ·»åŠ ç‚¹å‡»äº‹ä»¶
        dayCell.addEventListener('click', () => selectDate(date));
        
        grid.appendChild(dayCell);
      }
    }

    // é€‰æ‹©æ—¥æœŸ
    function selectDate(date) {
      selectedDate = date;
      renderCalendar();
      updatePlansDisplay();
    }

    // æ›´æ–°è®¡åˆ’æ˜¾ç¤º
    function updatePlansDisplay() {
      const dateKey = formatDateKey(selectedDate);
      const input = document.getElementById('plansInput');
      
      if (plans[dateKey]) {
        input.value = plans[dateKey].text;
      } else {
        input.value = '';
      }
      
      // æ›´æ–°é€‰ä¸­æ—¥æœŸæ˜¾ç¤º
      const dateStr = selectedDate.toLocaleDateString('zh-CN', {
        year: 'numeric',
        month: 'long',
        day: 'numeric',
        weekday: 'long'
      });
      document.getElementById('selectedDate').textContent = dateStr;
      
      // æ›´æ–°æ—¥æœŸä¿¡æ¯
      const today = new Date();
      const diffTime = Math.abs(selectedDate - today);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      let dateInfo = '';
      if (diffDays === 0) {
        dateInfo = 'ä»Šå¤©';
      } else if (diffDays === 1) {
        dateInfo = selectedDate > today ? 'æ˜å¤©' : 'æ˜¨å¤©';
      } else if (diffDays <= 7) {
        dateInfo = selectedDate > today ? `${diffDays}å¤©å` : `${diffDays}å¤©å‰`;
      }
      
      document.getElementById('dateInfo').textContent = dateInfo;
    }

    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    function updateStats() {
      const totalPlans = Object.keys(plans).length;
      const thisMonth = currentDate.getFullYear() + '-' + String(currentDate.getMonth() + 1).padStart(2, '0');
      const thisMonthPlans = Object.keys(plans).filter(key => key.startsWith(thisMonth)).length;
      const completedPlans = Object.values(plans).filter(plan => plan.completed).length;
      
      document.getElementById('totalPlans').textContent = totalPlans;
      document.getElementById('thisMonthPlans').textContent = thisMonthPlans;
      document.getElementById('completedPlans').textContent = completedPlans;
    }

    // å¯¼èˆªå‡½æ•°
    function previousMonth() {
      currentDate.setMonth(currentDate.getMonth() - 1);
      renderCalendar();
    }

    function nextMonth() {
      currentDate.setMonth(currentDate.getMonth() + 1);
      renderCalendar();
    }

    function goToToday() {
      currentDate = new Date();
      selectedDate = new Date();
      renderCalendar();
      updatePlansDisplay();
    }

    // å·¥å…·å‡½æ•°
    function formatDateKey(date) {
      return date.getFullYear() + '-' + 
             String(date.getMonth() + 1).padStart(2, '0') + '-' + 
             String(date.getDate()).padStart(2, '0');
    }

    // é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 's':
            e.preventDefault();
            savePlans();
            break;
          case 'ArrowLeft':
            e.preventDefault();
            previousMonth();
            break;
          case 'ArrowRight':
            e.preventDefault();
            nextMonth();
            break;
        }
      }
    });
  </script>
</body>
</html>
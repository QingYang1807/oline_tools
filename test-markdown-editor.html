<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Markdown ç¼–è¾‘å™¨åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    button { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>ğŸ§ª Markdown ç¼–è¾‘å™¨åŠŸèƒ½æµ‹è¯•</h1>
  
  <div class="test-section">
    <h2>ğŸ“‹ æµ‹è¯•é¡¹ç›®</h2>
    <p>ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®æ¥æµ‹è¯• Markdown ç¼–è¾‘å™¨çš„å„é¡¹åŠŸèƒ½ï¼š</p>
    
    <button onclick="testBasicFunctionality()">æµ‹è¯•åŸºæœ¬åŠŸèƒ½</button>
    <button onclick="testMarkdownParsing()">æµ‹è¯• Markdown è§£æ</button>
    <button onclick="testLocalStorage()">æµ‹è¯•æœ¬åœ°å­˜å‚¨</button>
    <button onclick="testPDFExport()">æµ‹è¯• PDF å¯¼å‡º</button>
    <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
  </div>

  <div id="testResults"></div>

  <div class="test-section">
    <h2>ğŸ”— ç›¸å…³é“¾æ¥</h2>
    <ul>
      <li><a href="tools/markdown-editor.html" target="_blank">æ‰“å¼€ Markdown ç¼–è¾‘å™¨</a></li>
      <li><a href="index.html">è¿”å›å·¥å…·ç®±é¦–é¡µ</a></li>
      <li><a href="demo-markdown.md" target="_blank">æŸ¥çœ‹æ¼”ç¤ºæ–‡æ¡£</a></li>
    </ul>
  </div>

  <script>
    let testResults = [];

    function addTestResult(testName, success, message) {
      const result = { name: testName, success, message, timestamp: new Date() };
      testResults.push(result);
      
      const resultsDiv = document.getElementById('testResults');
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
      resultDiv.innerHTML = `
        <strong>${testName}</strong>: ${success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
        <br><small>${message}</small>
        <br><small>æ—¶é—´: ${result.timestamp.toLocaleTimeString()}</small>
      `;
      resultsDiv.appendChild(resultDiv);
    }

    function testBasicFunctionality() {
      try {
        // æµ‹è¯•åŸºæœ¬ DOM æ“ä½œ
        const testDiv = document.createElement('div');
        testDiv.textContent = 'æµ‹è¯•å†…å®¹';
        document.body.appendChild(testDiv);
        document.body.removeChild(testDiv);
        
        addTestResult('åŸºæœ¬ DOM æ“ä½œ', true, 'DOM æ“ä½œæ­£å¸¸');
      } catch (error) {
        addTestResult('åŸºæœ¬ DOM æ“ä½œ', false, error.message);
      }
    }

    function testMarkdownParsing() {
      try {
        // æ£€æŸ¥æ˜¯å¦åŠ è½½äº† Marked åº“
        if (typeof marked !== 'undefined') {
          const testMarkdown = '**ç²—ä½“** *æ–œä½“*';
          const result = marked.parse(testMarkdown);
          
          if (result.includes('<strong>ç²—ä½“</strong>') && result.includes('<em>æ–œä½“</em>')) {
            addTestResult('Markdown è§£æ', true, 'Marked.js åº“åŠ è½½æ­£å¸¸ï¼Œè§£æåŠŸèƒ½æ­£å¸¸');
          } else {
            addTestResult('Markdown è§£æ', false, 'è§£æç»“æœä¸ç¬¦åˆé¢„æœŸ');
          }
        } else {
          addTestResult('Markdown è§£æ', false, 'Marked.js åº“æœªåŠ è½½');
        }
      } catch (error) {
        addTestResult('Markdown è§£æ', false, error.message);
      }
    }

    function testLocalStorage() {
      try {
        const testKey = 'test_markdown_editor';
        const testValue = 'æµ‹è¯•æ•°æ®';
        
        // æµ‹è¯•å†™å…¥
        localStorage.setItem(testKey, testValue);
        
        // æµ‹è¯•è¯»å–
        const readValue = localStorage.getItem(testKey);
        
        // æ¸…ç†æµ‹è¯•æ•°æ®
        localStorage.removeItem(testKey);
        
        if (readValue === testValue) {
          addTestResult('æœ¬åœ°å­˜å‚¨', true, 'localStorage è¯»å†™åŠŸèƒ½æ­£å¸¸');
        } else {
          addTestResult('æœ¬åœ°å­˜å‚¨', false, 'è¯»å–çš„æ•°æ®ä¸å†™å…¥çš„ä¸åŒ¹é…');
        }
      } catch (error) {
        addTestResult('æœ¬åœ°å­˜å‚¨', false, error.message);
      }
    }

    function testPDFExport() {
      try {
        // æ£€æŸ¥æ˜¯å¦åŠ è½½äº† html2pdf åº“
        if (typeof html2pdf !== 'undefined') {
          addTestResult('PDF å¯¼å‡ºåº“', true, 'html2pdf.js åº“åŠ è½½æ­£å¸¸');
        } else {
          addTestResult('PDF å¯¼å‡ºåº“', false, 'html2pdf.js åº“æœªåŠ è½½');
        }
      } catch (error) {
        addTestResult('PDF å¯¼å‡ºåº“', false, error.message);
      }
    }

    function runAllTests() {
      // æ¸…ç©ºä¹‹å‰çš„ç»“æœ
      document.getElementById('testResults').innerHTML = '';
      testResults = [];
      
      // è¿è¡Œæ‰€æœ‰æµ‹è¯•
      testBasicFunctionality();
      testMarkdownParsing();
      testLocalStorage();
      testPDFExport();
      
      // æ˜¾ç¤ºæµ‹è¯•æ€»ç»“
      setTimeout(() => {
        const totalTests = testResults.length;
        const passedTests = testResults.filter(r => r.success).length;
        const failedTests = totalTests - passedTests;
        
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'test-result info';
        summaryDiv.innerHTML = `
          <h3>ğŸ“Š æµ‹è¯•æ€»ç»“</h3>
          <p>æ€»æµ‹è¯•æ•°: ${totalTests}</p>
          <p>é€šè¿‡: ${passedTests} âœ…</p>
          <p>å¤±è´¥: ${failedTests} âŒ</p>
          <p>æˆåŠŸç‡: ${Math.round((passedTests / totalTests) * 100)}%</p>
        `;
        
        document.getElementById('testResults').appendChild(summaryDiv);
      }, 100);
    }

    // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºæœ¬æµ‹è¯•
    window.addEventListener('load', () => {
      addTestResult('é¡µé¢åŠ è½½', true, 'æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
    });
  </script>
</body>
</html>
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>接口请求工具 · 网页工具箱</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
  <meta name="color-scheme" content="light dark">
  <style>
    .api-tester {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .request-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .request-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .method-select {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
      min-width: 80px;
    }
    
    .url-input {
      flex: 1;
      min-width: 300px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
    }
    
    .send-btn {
      padding: 8px 20px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    
    .send-btn:hover {
      background: var(--accent-hover);
    }
    
    .send-btn:disabled {
      background: var(--muted);
      cursor: not-allowed;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--fg);
    }
    
    .form-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }
    
    .tab {
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    
    .tab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .response-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-success {
      background: #10b981;
      color: white;
    }
    
    .status-error {
      background: #ef4444;
      color: white;
    }
    
    .status-info {
      background: #3b82f6;
      color: white;
    }
    
    .response-time {
      color: var(--muted);
      font-size: 14px;
    }
    
    .response-content {
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 16px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .headers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 8px;
      align-items: center;
    }
    
    .add-header-btn {
      padding: 6px 12px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .remove-header-btn {
      padding: 4px 8px;
      background: #ef4444;
      color: white;
      border: none;
          border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .history-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .history-item:hover {
      background: var(--panel-bg);
    }
    
    .history-method {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      min-width: 40px;
      text-align: center;
    }
    
    .method-get { background: #10b981; color: white; }
    .method-post { background: #3b82f6; color: white; }
    .method-put { background: #f59e0b; color: white; }
    .method-delete { background: #ef4444; color: white; }
    .method-patch { background: #8b5cf6; color: white; }
    
    .history-url {
      flex: 1;
      font-size: 13px;
      color: var(--fg);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .history-time {
      font-size: 12px;
      color: var(--muted);
    }
    
    .clear-history-btn {
      padding: 6px 12px;
      background: var(--muted);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-left: auto;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="site-title">🔌 接口请求工具</h1>
      <p class="site-subtitle">简易的 API 测试工具，支持 GET/POST 等多种请求方法</p>
    </div>
  </header>

  <main class="container">
    <div class="api-tester">
      <!-- 请求历史 -->
      <div class="request-section">
        <h3>请求历史</h3>
        <div id="requestHistory"></div>
        <button class="clear-history-btn" onclick="clearHistory()">清空历史</button>
      </div>

      <!-- 功能说明 -->
      <div class="request-section">
        <h3>🚀 新功能说明</h3>
        <div style="background: var(--panel-bg); padding: 16px; border-radius: 8px; border-left: 4px solid var(--accent);">
          <p style="margin: 0 0 12px 0; color: var(--fg);"><strong>✅ 已解决307重定向跨域问题！</strong></p>
          <ul style="margin: 0; padding-left: 20px; color: var(--muted);">
            <li><strong>代理服务器模式：</strong>自动使用多个代理服务器，解决跨域限制</li>
            <li><strong>重定向处理：</strong>支持自动跟随重定向，或手动处理重定向链</li>
            <li><strong>智能切换：</strong>代理服务器失败时自动切换到备用服务器</li>
            <li><strong>完整支持：</strong>支持所有HTTP方法和请求类型</li>
          </ul>
        </div>
      </div>

      <!-- 请求配置 -->
      <div class="request-section">
        <h3>请求配置</h3>
        
        <div class="request-header">
          <select id="methodSelect" class="method-select">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="PATCH">PATCH</option>
          </select>
          
          <input type="url" id="urlInput" class="url-input" placeholder="请输入请求 URL" value="https://httpbin.org/get">
          
          <!-- 测试URL快捷按钮 -->
          <div style="display: flex; gap: 8px; margin-top: 8px; flex-wrap: wrap;">
            <button onclick="setTestUrl('https://httpbin.org/get')" style="padding: 4px 8px; background: var(--muted); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">测试GET</button>
            <button onclick="setTestUrl('https://httpbin.org/redirect/3')" style="padding: 4px 8px; background: var(--muted); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">测试重定向</button>
            <button onclick="setTestUrl('https://api.github.com/users/octocat')" style="padding: 4px 8px; background: var(--muted); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">测试跨域</button>
            <button onclick="setTestUrl('https://httpbin.org/status/307')" style="padding: 4px 8px; background: var(--muted); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">测试307</button>
          </div>
          
          <button id="sendBtn" class="send-btn" onclick="sendRequest()">
            <span id="sendBtnText">发送请求</span>
            <span id="sendBtnLoading" class="loading" style="display: none;"></span>
          </button>
        </div>

        <!-- 请求选项 -->
        <div class="form-group">
          <label class="form-label">请求选项</label>
          <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: center;">
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="useProxy" checked>
              <span>使用代理服务器（解决跨域问题）</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="followRedirects" checked>
              <span>自动跟随重定向</span>
            </label>
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
              <input type="checkbox" id="includeCredentials">
              <span>包含凭据（Cookies等）</span>
            </label>
          </div>
        </div>

        <!-- 请求头 -->
        <div class="form-group">
          <label class="form-label">请求头</label>
          <div id="headersContainer">
            <div class="headers-grid">
              <input type="text" class="form-input header-key" placeholder="Header 名称" value="Content-Type">
              <input type="text" class="form-input header-value" placeholder="Header 值" value="application/json">
              <button class="remove-header-btn" onclick="removeHeader(this)">删除</button>
            </div>
          </div>
          <button class="add-header-btn" onclick="addHeader()">添加请求头</button>
        </div>

        <!-- 请求体 -->
        <div class="form-group">
          <label class="form-label">请求体</label>
          <div class="tabs">
            <button class="tab active" onclick="switchTab('json')">JSON</button>
            <button class="tab" onclick="switchTab('form')">Form Data</button>
            <button class="tab" onclick="switchTab('raw')">Raw</button>
          </div>
          
          <div id="jsonTab" class="tab-content active">
            <textarea id="jsonBody" class="form-input form-textarea" placeholder='{"key": "value"}'>{
  "name": "test",
  "message": "Hello World"
}</textarea>
          </div>
          
          <div id="formTab" class="tab-content">
            <div id="formDataContainer">
              <div class="headers-grid">
                <input type="text" class="form-input form-key" placeholder="参数名" value="name">
                <input type="text" class="form-input form-value" placeholder="参数值" value="test">
                <button class="remove-header-btn" onclick="removeFormField(this)">删除</button>
              </div>
            </div>
            <button class="add-header-btn" onclick="addFormField()">添加参数</button>
          </div>
          
          <div id="rawTab" class="tab-content">
            <textarea id="rawBody" class="form-input form-textarea" placeholder="输入原始请求体内容"></textarea>
          </div>
        </div>
      </div>

      <!-- 响应结果 -->
      <div class="response-section">
        <h3>响应结果</h3>
        <div id="responseContent" style="display: none;">
          <div class="response-header">
            <div>
              <span id="statusBadge" class="status-badge status-info">200 OK</span>
              <span id="responseTime" class="response-time">响应时间: 0ms</span>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">响应头</label>
            <pre id="responseHeaders" class="response-content"></pre>
          </div>
          
          <div class="form-group">
            <label class="form-label">响应体</label>
            <pre id="responseBody" class="response-content"></pre>
          </div>
        </div>
        
        <div id="noResponse" style="text-align: center; color: var(--muted); padding: 40px;">
          点击"发送请求"开始测试接口
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <span>© <span id="year"></span> 网页工具箱</span>
    </div>
  </footer>

  <script>
    // 请求历史
    let requestHistory = JSON.parse(localStorage.getItem('apiTesterHistory') || '[]');
    
    // 初始化
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('year').textContent = new Date().getFullYear();
      renderHistory();
      
      // 监听方法变化，自动显示/隐藏请求体
      document.getElementById('methodSelect').addEventListener('change', function() {
        const method = this.value;
        const bodySection = document.querySelector('.form-group:last-child');
        if (method === 'GET') {
          bodySection.style.display = 'none';
        } else {
          bodySection.style.display = 'block';
        }
      });
      
      // 初始隐藏 GET 方法的请求体
      if (document.getElementById('methodSelect').value === 'GET') {
        document.querySelector('.form-group:last-child').style.display = 'none';
      }
    });
    
    // 切换标签页
    function switchTab(tabName) {
      // 隐藏所有标签页内容
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // 移除所有标签页的激活状态
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // 显示选中的标签页内容
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // 激活对应的标签
      event.target.classList.add('active');
    }
    
    // 添加请求头
    function addHeader() {
      const container = document.getElementById('headersContainer');
      const headerDiv = document.createElement('div');
      headerDiv.className = 'headers-grid';
      headerDiv.innerHTML = `
        <input type="text" class="form-input header-key" placeholder="Header 名称">
        <input type="text" class="form-input header-value" placeholder="Header 值">
        <button class="remove-header-btn" onclick="removeHeader(this)">删除</button>
      `;
      container.appendChild(headerDiv);
    }
    
    // 删除请求头
    function removeHeader(btn) {
      btn.parentElement.remove();
    }
    
    // 添加表单字段
    function addFormField() {
      const container = document.getElementById('formDataContainer');
      const fieldDiv = document.createElement('div');
      fieldDiv.className = 'headers-grid';
      fieldDiv.innerHTML = `
        <input type="text" class="form-input form-key" placeholder="参数名">
        <input type="text" class="form-input form-value" placeholder="参数值">
        <button class="remove-header-btn" onclick="removeFormField(this)">删除</button>
      `;
      container.appendChild(fieldDiv);
    }
    
    // 删除表单字段
    function removeFormField(btn) {
      btn.parentElement.remove();
    }
    
    // 代理服务器列表
    const proxyServers = [
      'https://api.allorigins.win/raw?url=',
      'https://cors-anywhere.herokuapp.com/',
      'https://thingproxy.freeboard.io/fetch/',
      'https://api.codetabs.com/v1/proxy?quest='
    ];
    
    let currentProxyIndex = 0;
    
    // 发送请求
    async function sendRequest() {
      const method = document.getElementById('methodSelect').value;
      let url = document.getElementById('urlInput').value.trim();
      
      if (!url) {
        alert('请输入请求 URL');
        return;
      }
      
      // 显示加载状态
      const sendBtn = document.getElementById('sendBtn');
      const sendBtnText = document.getElementById('sendBtnText');
      const sendBtnLoading = document.getElementById('sendBtnLoading');
      
      sendBtn.disabled = true;
      sendBtnText.style.display = 'none';
      sendBtnLoading.style.display = 'inline-block';
      
      try {
        const startTime = Date.now();
        
        // 构建请求头
        const headers = {};
        document.querySelectorAll('.header-key').forEach((keyInput, index) => {
          const key = keyInput.value.trim();
          const value = document.querySelectorAll('.header-value')[index].value.trim();
          if (key && value) {
            headers[key] = value;
          }
        });
        
        // 构建请求体
        let body = null;
        if (method !== 'GET') {
          const activeTab = document.querySelector('.tab.active').textContent.toLowerCase();
          
          if (activeTab === 'json') {
            const jsonBody = document.getElementById('jsonBody').value.trim();
            if (jsonBody) {
              try {
                body = JSON.stringify(JSON.parse(jsonBody));
                headers['Content-Type'] = 'application/json';
              } catch (e) {
                alert('JSON 格式错误');
                return;
              }
            }
          } else if (activeTab === 'form') {
            const formData = new FormData();
            document.querySelectorAll('.form-key').forEach((keyInput, index) => {
              const key = keyInput.value.trim();
              const value = document.querySelectorAll('.form-value')[index].value.trim();
              if (key && value) {
                formData.append(key, value);
              }
            });
            body = formData;
            // FormData 会自动设置 Content-Type
          } else if (activeTab === 'raw') {
            const rawBody = document.getElementById('rawBody').value.trim();
            if (rawBody) {
              body = rawBody;
            }
          }
        }
        
        // 检查是否使用代理
        const useProxy = document.getElementById('useProxy').checked;
        const followRedirects = document.getElementById('followRedirects').checked;
        const includeCredentials = document.getElementById('includeCredentials').checked;
        
        let response;
        let redirectChain = [];
        let finalUrl = url;
        
        if (useProxy) {
          // 使用代理服务器
          response = await sendRequestWithProxy(url, method, headers, body, followRedirects, includeCredentials);
          finalUrl = response.finalUrl || url;
          redirectChain = response.redirectChain || [];
        } else {
          // 直接请求
          const fetchOptions = {
            method: method,
            headers: headers,
            body: body,
            redirect: followRedirects ? 'follow' : 'manual',
            credentials: includeCredentials ? 'include' : 'same-origin'
          };
          
          response = await fetch(url, fetchOptions);
          
          // 处理手动重定向
          if (!followRedirects && (response.status === 301 || response.status === 302 || response.status === 307 || response.status === 308)) {
            const location = response.headers.get('Location');
            if (location) {
              redirectChain.push({
                from: url,
                to: location,
                status: response.status,
                statusText: response.statusText
              });
              finalUrl = location;
            }
          }
        }
        
        const endTime = Date.now();
        const responseTime = endTime - startTime;
        
        // 获取响应头
        const responseHeaders = {};
        response.headers.forEach((value, key) => {
          responseHeaders[key] = value;
        });
        
        // 获取响应体
        let responseBody;
        const contentType = response.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
          try {
            responseBody = await response.json();
            responseBody = JSON.stringify(responseBody, null, 2);
          } catch (e) {
            responseBody = await response.text();
          }
        } else {
          responseBody = await response.text();
        }
        
        // 清理之前的重定向信息
        clearRedirectInfo();
        
        // 显示响应结果
        displayResponse(response.status, response.statusText, responseTime, responseHeaders, responseBody, redirectChain, finalUrl);
        
        // 保存到历史记录
        saveToHistory(method, url, response.status);
        
      } catch (error) {
        console.error('请求失败:', error);
        displayError(error.message);
      } finally {
        // 恢复按钮状态
        sendBtn.disabled = false;
        sendBtnText.style.display = 'inline';
        sendBtnLoading.style.display = 'none';
      }
    }
    
    // 使用代理服务器发送请求
    async function sendRequestWithProxy(originalUrl, method, headers, body, followRedirects, includeCredentials) {
      const proxyUrl = proxyServers[currentProxyIndex] + encodeURIComponent(originalUrl);
      
      try {
        const proxyHeaders = {
          ...headers,
          'X-Requested-With': 'XMLHttpRequest'
        };
        
        const fetchOptions = {
          method: method,
          headers: proxyHeaders,
          body: body,
          redirect: followRedirects ? 'follow' : 'manual',
          credentials: includeCredentials ? 'include' : 'same-origin'
        };
        
        const response = await fetch(proxyUrl, fetchOptions);
        
        // 如果代理失败，尝试下一个代理
        if (!response.ok && response.status >= 500) {
          currentProxyIndex = (currentProxyIndex + 1) % proxyServers.length;
          console.log(`代理服务器失败，切换到: ${proxyServers[currentProxyIndex]}`);
          return await sendRequestWithProxy(originalUrl, method, headers, body, followRedirects, includeCredentials);
        }
        
        return {
          ...response,
          finalUrl: originalUrl,
          redirectChain: []
        };
        
      } catch (error) {
        // 尝试下一个代理服务器
        currentProxyIndex = (currentProxyIndex + 1) % proxyServers.length;
        if (currentProxyIndex === 0) {
          throw new Error(`所有代理服务器都失败了: ${error.message}`);
        }
        console.log(`代理服务器错误，切换到: ${proxyServers[currentProxyIndex]}`);
        return await sendRequestWithProxy(originalUrl, method, headers, body, followRedirects, includeCredentials);
      }
    }
    
    // 清理重定向信息显示
    function clearRedirectInfo() {
      const responseHeader = document.querySelector('.response-header');
      const existingRedirectInfo = responseHeader.querySelector('.redirect-info');
      if (existingRedirectInfo) {
        existingRedirectInfo.remove();
      }
    }
    
    // 手动跟随重定向
    async function followRedirect(redirectUrl) {
      document.getElementById('urlInput').value = redirectUrl;
      await sendRequest();
    }
    
    // 设置测试URL
    function setTestUrl(url) {
      document.getElementById('urlInput').value = url;
    }
    
    // 显示响应结果
    function displayResponse(status, statusText, responseTime, headers, body, redirectChain = [], finalUrl = '') {
      document.getElementById('noResponse').style.display = 'none';
      document.getElementById('responseContent').style.display = 'block';
      
      // 状态码
      const statusBadge = document.getElementById('statusBadge');
      statusBadge.textContent = `${status} ${statusText}`;
      statusBadge.className = 'status-badge ' + (status >= 200 && status < 300 ? 'status-success' : 'status-error');
      
      // 响应时间
      document.getElementById('responseTime').textContent = `响应时间: ${responseTime}ms`;
      
      // 如果有重定向链，显示重定向信息
      if (redirectChain.length > 0) {
        const redirectInfo = document.createElement('div');
        redirectInfo.className = 'redirect-info';
        redirectInfo.style.marginBottom = '16px';
        redirectInfo.style.padding = '12px';
        redirectInfo.style.backgroundColor = 'var(--panel-bg)';
        redirectInfo.style.border = '1px solid var(--border)';
        redirectInfo.style.borderRadius = '6px';
        redirectInfo.innerHTML = `
          <div style="font-weight: 500; margin-bottom: 8px; color: var(--accent);">重定向链:</div>
          ${redirectChain.map(redirect => `
            <div style="margin-bottom: 8px; font-size: 13px; padding: 8px; background: var(--card); border-radius: 4px;">
              <div style="color: var(--muted); margin-bottom: 4px;">${redirect.status} ${redirect.statusText}</div>
              <div style="color: var(--fg); margin-bottom: 4px;">从: ${redirect.from}</div>
              <div style="color: var(--accent); margin-bottom: 8px;">到: ${redirect.to}</div>
              <button onclick="followRedirect('${redirect.to}')" style="padding: 4px 8px; background: var(--accent); color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">跟随重定向</button>
            </div>
          `).join('')}
          ${finalUrl ? `<div style="margin-top: 8px; font-weight: 500; color: var(--accent);">最终URL: ${finalUrl}</div>` : ''}
        `;
        
        const responseHeader = document.querySelector('.response-header');
        responseHeader.appendChild(redirectInfo);
      }
      
      // 响应头
      document.getElementById('responseHeaders').textContent = JSON.stringify(headers, null, 2);
      
      // 响应体
      document.getElementById('responseBody').textContent = body;
    }
    
    // 显示错误
    function displayError(message) {
      document.getElementById('noResponse').style.display = 'none';
      document.getElementById('responseContent').style.display = 'block';
      
      document.getElementById('statusBadge').textContent = 'Error';
      document.getElementById('statusBadge').className = 'status-badge status-error';
      document.getElementById('responseTime').textContent = '请求失败';
      document.getElementById('responseHeaders').textContent = '';
      document.getElementById('responseBody').textContent = `请求失败: ${message}`;
    }
    
    // 保存到历史记录
    function saveToHistory(method, url, status) {
      const historyItem = {
        method: method,
        url: url,
        status: status,
        timestamp: new Date().toLocaleString()
      };
      
      // 避免重复记录
      const existingIndex = requestHistory.findIndex(item => 
        item.method === method && item.url === url
      );
      
      if (existingIndex !== -1) {
        requestHistory.splice(existingIndex, 1);
      }
      
      requestHistory.unshift(historyItem);
      
      // 限制历史记录数量
      if (requestHistory.length > 20) {
        requestHistory = requestHistory.slice(0, 20);
      }
      
      localStorage.setItem('apiTesterHistory', JSON.stringify(requestHistory));
      renderHistory();
    }
    
    // 渲染历史记录
    function renderHistory() {
      const container = document.getElementById('requestHistory');
      if (requestHistory.length === 0) {
        container.innerHTML = '<p style="color: var(--muted); text-align: center;">暂无请求历史</p>';
        return;
      }
      
      container.innerHTML = requestHistory.map(item => `
        <div class="history-item" onclick="loadFromHistory('${item.method}', '${item.url}')">
          <span class="history-method method-${item.method.toLowerCase()}">${item.method}</span>
          <span class="history-url">${item.url}</span>
          <span class="history-time">${item.timestamp}</span>
        </div>
      `).join('');
    }
    
    // 从历史记录加载
    function loadFromHistory(method, url) {
      document.getElementById('methodSelect').value = method;
      document.getElementById('urlInput').value = url;
      
      // 滚动到请求配置区域
      document.querySelector('.request-section:nth-child(2)').scrollIntoView({ behavior: 'smooth' });
    }
    
    // 清空历史记录
    function clearHistory() {
      if (confirm('确定要清空所有请求历史吗？')) {
        requestHistory = [];
        localStorage.removeItem('apiTesterHistory');
        renderHistory();
      }
    }
  </script>
</body>
</html>
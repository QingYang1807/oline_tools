<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Êé•Âè£ËØ∑Ê±ÇÂ∑•ÂÖ∑ ¬∑ ÁΩëÈ°µÂ∑•ÂÖ∑ÁÆ±</title>
  <link rel="stylesheet" href="../assets/css/style.css">
  <meta name="color-scheme" content="light dark">
  <style>
    .api-tester {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .request-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .request-header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .method-select {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
      min-width: 80px;
    }
    
    .url-input {
      flex: 1;
      min-width: 300px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
    }
    
    .send-btn {
      padding: 8px 20px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: background 0.2s;
    }
    
    .send-btn:hover {
      background: var(--accent-hover);
    }
    
    .send-btn:disabled {
      background: var(--muted);
      cursor: not-allowed;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--fg);
    }
    
    .form-input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--card);
      color: var(--fg);
      font-size: 14px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
    }
    
    .form-textarea {
      min-height: 120px;
      resize: vertical;
    }
    
    .tabs {
      display: flex;
      border-bottom: 1px solid var(--border);
      margin-bottom: 16px;
    }
    
    .tab {
      padding: 8px 16px;
      border: none;
      background: none;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    
    .tab.active {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }
    
    .tab-content {
      display: none;
    }
    
    .tab-content.active {
      display: block;
    }
    
    .response-section {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px var(--shadow);
    }
    
    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--border);
    }
    
    .status-badge {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .status-success {
      background: #10b981;
      color: white;
    }
    
    .status-error {
      background: #ef4444;
      color: white;
    }
    
    .status-info {
      background: #3b82f6;
      color: white;
    }
    
    .response-time {
      color: var(--muted);
      font-size: 14px;
    }
    
    .response-content {
      background: var(--panel-bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 16px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 13px;
      line-height: 1.5;
      white-space: pre-wrap;
      word-break: break-all;
      max-height: 400px;
      overflow-y: auto;
    }
    
    .headers-grid {
      display: grid;
      grid-template-columns: 1fr 1fr auto;
      gap: 8px;
      align-items: center;
    }
    
    .add-header-btn {
      padding: 6px 12px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .remove-header-btn {
      padding: 4px 8px;
      background: #ef4444;
      color: white;
      border: none;
          border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .loading {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .history-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: 6px;
      margin-bottom: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .history-item:hover {
      background: var(--panel-bg);
    }
    
    .history-method {
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      min-width: 40px;
      text-align: center;
    }
    
    .method-get { background: #10b981; color: white; }
    .method-post { background: #3b82f6; color: white; }
    .method-put { background: #f59e0b; color: white; }
    .method-delete { background: #ef4444; color: white; }
    .method-patch { background: #8b5cf6; color: white; }
    
    .history-url {
      flex: 1;
      font-size: 13px;
      color: var(--fg);
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    
    .history-time {
      font-size: 12px;
      color: var(--muted);
    }
    
    .clear-history-btn {
      padding: 6px 12px;
      background: var(--muted);
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      margin-left: auto;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="site-title">üîå Êé•Âè£ËØ∑Ê±ÇÂ∑•ÂÖ∑</h1>
      <p class="site-subtitle">ÁÆÄÊòìÁöÑ API ÊµãËØïÂ∑•ÂÖ∑ÔºåÊîØÊåÅ GET/POST Á≠âÂ§öÁßçËØ∑Ê±ÇÊñπÊ≥ï</p>
    </div>
  </header>

  <main class="container">
    <div class="api-tester">
      <!-- ËØ∑Ê±ÇÂéÜÂè≤ -->
      <div class="request-section">
        <h3>ËØ∑Ê±ÇÂéÜÂè≤</h3>
        <div id="requestHistory"></div>
        <button class="clear-history-btn" onclick="clearHistory()">Ê∏ÖÁ©∫ÂéÜÂè≤</button>
      </div>

      <!-- ËØ∑Ê±ÇÈÖçÁΩÆ -->
      <div class="request-section">
        <h3>ËØ∑Ê±ÇÈÖçÁΩÆ</h3>
        
        <div class="request-header">
          <select id="methodSelect" class="method-select">
            <option value="GET">GET</option>
            <option value="POST">POST</option>
            <option value="PUT">PUT</option>
            <option value="DELETE">DELETE</option>
            <option value="PATCH">PATCH</option>
          </select>
          
          <input type="url" id="urlInput" class="url-input" placeholder="ËØ∑ËæìÂÖ•ËØ∑Ê±Ç URL" value="https://httpbin.org/get">
          
          <button id="sendBtn" class="send-btn" onclick="sendRequest()">
            <span id="sendBtnText">ÂèëÈÄÅËØ∑Ê±Ç</span>
            <span id="sendBtnLoading" class="loading" style="display: none;"></span>
          </button>
        </div>

        <!-- ËØ∑Ê±ÇÂ§¥ -->
        <div class="form-group">
          <label class="form-label">ËØ∑Ê±ÇÂ§¥</label>
          <div id="headersContainer">
            <div class="headers-grid">
              <input type="text" class="form-input header-key" placeholder="Header ÂêçÁß∞" value="Content-Type">
              <input type="text" class="form-input header-value" placeholder="Header ÂÄº" value="application/json">
              <button class="remove-header-btn" onclick="removeHeader(this)">Âà†Èô§</button>
            </div>
          </div>
          <button class="add-header-btn" onclick="addHeader()">Ê∑ªÂä†ËØ∑Ê±ÇÂ§¥</button>
        </div>

        <!-- ËØ∑Ê±Ç‰Ωì -->
        <div class="form-group">
          <label class="form-label">ËØ∑Ê±Ç‰Ωì</label>
          <div class="tabs">
            <button class="tab active" onclick="switchTab('json')">JSON</button>
            <button class="tab" onclick="switchTab('form')">Form Data</button>
            <button class="tab" onclick="switchTab('raw')">Raw</button>
          </div>
          
          <div id="jsonTab" class="tab-content active">
            <textarea id="jsonBody" class="form-input form-textarea" placeholder='{"key": "value"}'>{
  "name": "test",
  "message": "Hello World"
}</textarea>
          </div>
          
          <div id="formTab" class="tab-content">
            <div id="formDataContainer">
              <div class="headers-grid">
                <input type="text" class="form-input form-key" placeholder="ÂèÇÊï∞Âêç" value="name">
                <input type="text" class="form-input form-value" placeholder="ÂèÇÊï∞ÂÄº" value="test">
                <button class="remove-header-btn" onclick="removeFormField(this)">Âà†Èô§</button>
              </div>
            </div>
            <button class="add-header-btn" onclick="addFormField()">Ê∑ªÂä†ÂèÇÊï∞</button>
          </div>
          
          <div id="rawTab" class="tab-content">
            <textarea id="rawBody" class="form-input form-textarea" placeholder="ËæìÂÖ•ÂéüÂßãËØ∑Ê±Ç‰ΩìÂÜÖÂÆπ"></textarea>
          </div>
        </div>
      </div>

      <!-- ÂìçÂ∫îÁªìÊûú -->
      <div class="response-section">
        <h3>ÂìçÂ∫îÁªìÊûú</h3>
        <div id="responseContent" style="display: none;">
          <div class="response-header">
            <div>
              <span id="statusBadge" class="status-badge status-info">200 OK</span>
              <span id="responseTime" class="response-time">ÂìçÂ∫îÊó∂Èó¥: 0ms</span>
            </div>
          </div>
          
          <div class="form-group">
            <label class="form-label">ÂìçÂ∫îÂ§¥</label>
            <pre id="responseHeaders" class="response-content"></pre>
          </div>
          
          <div class="form-group">
            <label class="form-label">ÂìçÂ∫î‰Ωì</label>
            <pre id="responseBody" class="response-content"></pre>
          </div>
        </div>
        
        <div id="noResponse" style="text-align: center; color: var(--muted); padding: 40px;">
          ÁÇπÂáª"ÂèëÈÄÅËØ∑Ê±Ç"ÂºÄÂßãÊµãËØïÊé•Âè£
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <span>¬© <span id="year"></span> ÁΩëÈ°µÂ∑•ÂÖ∑ÁÆ±</span>
    </div>
  </footer>

  <script>
    // ËØ∑Ê±ÇÂéÜÂè≤
    let requestHistory = JSON.parse(localStorage.getItem('apiTesterHistory') || '[]');
    
    // ÂàùÂßãÂåñ
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('year').textContent = new Date().getFullYear();
      renderHistory();
      
      // ÁõëÂê¨ÊñπÊ≥ïÂèòÂåñÔºåËá™Âä®ÊòæÁ§∫/ÈöêËóèËØ∑Ê±Ç‰Ωì
      document.getElementById('methodSelect').addEventListener('change', function() {
        const method = this.value;
        const bodySection = document.querySelector('.form-group:last-child');
        if (method === 'GET') {
          bodySection.style.display = 'none';
        } else {
          bodySection.style.display = 'block';
        }
      });
      
      // ÂàùÂßãÈöêËóè GET ÊñπÊ≥ïÁöÑËØ∑Ê±Ç‰Ωì
      if (document.getElementById('methodSelect').value === 'GET') {
        document.querySelector('.form-group:last-child').style.display = 'none';
      }
    });
    
    // ÂàáÊç¢Ê†áÁ≠æÈ°µ
    function switchTab(tabName) {
      // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÈ°µÂÜÖÂÆπ
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÈ°µÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      
      // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÈ°µÂÜÖÂÆπ
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // ÊøÄÊ¥ªÂØπÂ∫îÁöÑÊ†áÁ≠æ
      event.target.classList.add('active');
    }
    
    // Ê∑ªÂä†ËØ∑Ê±ÇÂ§¥
    function addHeader() {
      const container = document.getElementById('headersContainer');
      const headerDiv = document.createElement('div');
      headerDiv.className = 'headers-grid';
      headerDiv.innerHTML = `
        <input type="text" class="form-input header-key" placeholder="Header ÂêçÁß∞">
        <input type="text" class="form-input header-value" placeholder="Header ÂÄº">
        <button class="remove-header-btn" onclick="removeHeader(this)">Âà†Èô§</button>
      `;
      container.appendChild(headerDiv);
    }
    
    // Âà†Èô§ËØ∑Ê±ÇÂ§¥
    function removeHeader(btn) {
      btn.parentElement.remove();
    }
    
    // Ê∑ªÂä†Ë°®ÂçïÂ≠óÊÆµ
    function addFormField() {
      const container = document.getElementById('formDataContainer');
      const fieldDiv = document.createElement('div');
      fieldDiv.className = 'headers-grid';
      fieldDiv.innerHTML = `
        <input type="text" class="form-input form-key" placeholder="ÂèÇÊï∞Âêç">
        <input type="text" class="form-input form-value" placeholder="ÂèÇÊï∞ÂÄº">
        <button class="remove-header-btn" onclick="removeFormField(this)">Âà†Èô§</button>
      `;
      container.appendChild(fieldDiv);
    }
    
    // Âà†Èô§Ë°®ÂçïÂ≠óÊÆµ
    function removeFormField(btn) {
      btn.parentElement.remove();
    }
    
    // ÂèëÈÄÅËØ∑Ê±Ç
    async function sendRequest() {
      const method = document.getElementById('methodSelect').value;
      const url = document.getElementById('urlInput').value.trim();
      
      if (!url) {
        alert('ËØ∑ËæìÂÖ•ËØ∑Ê±Ç URL');
        return;
      }
      
      // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
      const sendBtn = document.getElementById('sendBtn');
      const sendBtnText = document.getElementById('sendBtnText');
      const sendBtnLoading = document.getElementById('sendBtnLoading');
      
      sendBtn.disabled = true;
      sendBtnText.style.display = 'none';
      sendBtnLoading.style.display = 'inline-block';
      
      try {
        const startTime = Date.now();
        
        // ÊûÑÂª∫ËØ∑Ê±ÇÂ§¥
        const headers = {};
        document.querySelectorAll('.header-key').forEach((keyInput, index) => {
          const key = keyInput.value.trim();
          const value = document.querySelectorAll('.header-value')[index].value.trim();
          if (key && value) {
            headers[key] = value;
          }
        });
        
        // ÊûÑÂª∫ËØ∑Ê±Ç‰Ωì
        let body = null;
        if (method !== 'GET') {
          const activeTab = document.querySelector('.tab.active').textContent.toLowerCase();
          
          if (activeTab === 'json') {
            const jsonBody = document.getElementById('jsonBody').value.trim();
            if (jsonBody) {
              try {
                body = JSON.stringify(JSON.parse(jsonBody));
                headers['Content-Type'] = 'application/json';
              } catch (e) {
                alert('JSON Ê†ºÂºèÈîôËØØ');
                return;
              }
            }
          } else if (activeTab === 'form') {
            const formData = new FormData();
            document.querySelectorAll('.form-key').forEach((keyInput, index) => {
              const key = keyInput.value.trim();
              const value = document.querySelectorAll('.form-value')[index].value.trim();
              if (key && value) {
                formData.append(key, value);
              }
            });
            body = formData;
            // FormData ‰ºöËá™Âä®ËÆæÁΩÆ Content-Type
          } else if (activeTab === 'raw') {
            const rawBody = document.getElementById('rawBody').value.trim();
            if (rawBody) {
              body = rawBody;
            }
          }
        }
        
        // ÂèëÈÄÅËØ∑Ê±Ç
        const response = await fetch(url, {
          method: method,
          headers: method === 'GET' ? headers : headers,
          body: body
        });
        
        const endTime = Date.now();
        const responseTime = endTime - startTime;
        
        // Ëé∑ÂèñÂìçÂ∫îÂ§¥
        const responseHeaders = {};
        response.headers.forEach((value, key) => {
          responseHeaders[key] = value;
        });
        
        // Ëé∑ÂèñÂìçÂ∫î‰Ωì
        let responseBody;
        const contentType = response.headers.get('content-type') || '';
        if (contentType.includes('application/json')) {
          responseBody = await response.json();
          responseBody = JSON.stringify(responseBody, null, 2);
        } else {
          responseBody = await response.text();
        }
        
        // ÊòæÁ§∫ÂìçÂ∫îÁªìÊûú
        displayResponse(response.status, response.statusText, responseTime, responseHeaders, responseBody);
        
        // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
        saveToHistory(method, url, response.status);
        
      } catch (error) {
        console.error('ËØ∑Ê±ÇÂ§±Ë¥•:', error);
        displayError(error.message);
      } finally {
        // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
        sendBtn.disabled = false;
        sendBtnText.style.display = 'inline';
        sendBtnLoading.style.display = 'none';
      }
    }
    
    // ÊòæÁ§∫ÂìçÂ∫îÁªìÊûú
    function displayResponse(status, statusText, responseTime, headers, body) {
      document.getElementById('noResponse').style.display = 'none';
      document.getElementById('responseContent').style.display = 'block';
      
      // Áä∂ÊÄÅÁ†Å
      const statusBadge = document.getElementById('statusBadge');
      statusBadge.textContent = `${status} ${statusText}`;
      statusBadge.className = 'status-badge ' + (status >= 200 && status < 300 ? 'status-success' : 'status-error');
      
      // ÂìçÂ∫îÊó∂Èó¥
      document.getElementById('responseTime').textContent = `ÂìçÂ∫îÊó∂Èó¥: ${responseTime}ms`;
      
      // ÂìçÂ∫îÂ§¥
      document.getElementById('responseHeaders').textContent = JSON.stringify(headers, null, 2);
      
      // ÂìçÂ∫î‰Ωì
      document.getElementById('responseBody').textContent = body;
    }
    
    // ÊòæÁ§∫ÈîôËØØ
    function displayError(message) {
      document.getElementById('noResponse').style.display = 'none';
      document.getElementById('responseContent').style.display = 'block';
      
      document.getElementById('statusBadge').textContent = 'Error';
      document.getElementById('statusBadge').className = 'status-badge status-error';
      document.getElementById('responseTime').textContent = 'ËØ∑Ê±ÇÂ§±Ë¥•';
      document.getElementById('responseHeaders').textContent = '';
      document.getElementById('responseBody').textContent = `ËØ∑Ê±ÇÂ§±Ë¥•: ${message}`;
    }
    
    // ‰øùÂ≠òÂà∞ÂéÜÂè≤ËÆ∞ÂΩï
    function saveToHistory(method, url, status) {
      const historyItem = {
        method: method,
        url: url,
        status: status,
        timestamp: new Date().toLocaleString()
      };
      
      // ÈÅøÂÖçÈáçÂ§çËÆ∞ÂΩï
      const existingIndex = requestHistory.findIndex(item => 
        item.method === method && item.url === url
      );
      
      if (existingIndex !== -1) {
        requestHistory.splice(existingIndex, 1);
      }
      
      requestHistory.unshift(historyItem);
      
      // ÈôêÂà∂ÂéÜÂè≤ËÆ∞ÂΩïÊï∞Èáè
      if (requestHistory.length > 20) {
        requestHistory = requestHistory.slice(0, 20);
      }
      
      localStorage.setItem('apiTesterHistory', JSON.stringify(requestHistory));
      renderHistory();
    }
    
    // Ê∏≤ÊüìÂéÜÂè≤ËÆ∞ÂΩï
    function renderHistory() {
      const container = document.getElementById('requestHistory');
      if (requestHistory.length === 0) {
        container.innerHTML = '<p style="color: var(--muted); text-align: center;">ÊöÇÊó†ËØ∑Ê±ÇÂéÜÂè≤</p>';
        return;
      }
      
      container.innerHTML = requestHistory.map(item => `
        <div class="history-item" onclick="loadFromHistory('${item.method}', '${item.url}')">
          <span class="history-method method-${item.method.toLowerCase()}">${item.method}</span>
          <span class="history-url">${item.url}</span>
          <span class="history-time">${item.timestamp}</span>
        </div>
      `).join('');
    }
    
    // ‰ªéÂéÜÂè≤ËÆ∞ÂΩïÂä†ËΩΩ
    function loadFromHistory(method, url) {
      document.getElementById('methodSelect').value = method;
      document.getElementById('urlInput').value = url;
      
      // ÊªöÂä®Âà∞ËØ∑Ê±ÇÈÖçÁΩÆÂå∫Âüü
      document.querySelector('.request-section:nth-child(2)').scrollIntoView({ behavior: 'smooth' });
    }
    
    // Ê∏ÖÁ©∫ÂéÜÂè≤ËÆ∞ÂΩï
    function clearHistory() {
      if (confirm('Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâËØ∑Ê±ÇÂéÜÂè≤ÂêóÔºü')) {
        requestHistory = [];
        localStorage.removeItem('apiTesterHistory');
        renderHistory();
      }
    }
  </script>
</body>
</html>
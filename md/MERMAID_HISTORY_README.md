# 🎨 Mermaid 可视化渲染器 - 历史记录版

## 概述

这是 Mermaid 可视化渲染器的最新版本，在原有功能基础上增加了完整的历史记录管理功能，并针对手机端进行了全面优化。

## 🚀 新增功能

### 📚 历史记录管理
- **自动保存**：渲染过的图标自动记录到 localStorage
- **历史列表**：直观的卡片式历史记录展示
- **快速操作**：一键查看、切换、编辑、删除历史记录
- **智能标题**：自动生成或自定义图表标题
- **时间显示**：人性化的相对时间显示（如"5分钟前"）

### 📱 手机端适配
- **响应式布局**：自动适配不同屏幕尺寸
- **触屏优化**：按钮大小和间距适合触屏操作
- **单列布局**：手机端自动切换为上下布局
- **折叠面板**：历史记录面板支持展开/收起

### ⚡ 增强功能
- **键盘快捷键**：
  - `Ctrl/Cmd + Enter`：渲染图表
  - `Ctrl/Cmd + S`：保存到历史
  - `ESC`：关闭全屏模式
- **自动渲染**：输入代码后自动渲染（1秒延迟）
- **数据导出**：支持导出历史记录为 JSON 文件
- **全屏查看**：支持全屏模式查看图表

## 📋 功能列表

### 基础功能
- [x] Mermaid 代码实时渲染
- [x] PNG/SVG 图片下载
- [x] 图片复制到剪贴板
- [x] 全屏查看模式
- [x] 错误提示和状态反馈

### 历史记录功能
- [x] 自动保存渲染记录
- [x] 历史记录列表展示
- [x] 快速加载历史项
- [x] 编辑历史记录标题和代码
- [x] 删除单个历史记录
- [x] 清空所有历史记录
- [x] 导出历史记录数据
- [x] 历史记录数量限制（最多50条）

### 移动端优化
- [x] 响应式设计
- [x] 触屏友好的按钮大小
- [x] 单列布局适配
- [x] 状态消息位置优化
- [x] 全屏模式移动端适配

## 🎯 使用方法

### 基本操作
1. 在文本框中输入 Mermaid 代码
2. 点击"🎨 渲染图表"按钮查看效果
3. 使用下载或复制按钮保存图表

### 历史记录操作
1. 点击"💾 保存到历史"将当前图表保存
2. 点击"📚 历史记录"查看历史列表
3. 在历史列表中：
   - 点击项目：加载该历史记录
   - 点击"编辑"：修改标题和代码
   - 点击"删除"：删除该记录

### 快捷键
- `Ctrl/Cmd + Enter`：快速渲染
- `Ctrl/Cmd + S`：保存到历史
- `ESC`：关闭全屏

## 🔧 技术特性

### 数据存储
- 使用 `localStorage` 本地存储历史记录
- 数据格式：JSON，包含标题、代码、时间戳等信息
- 自动去重：相同代码的记录会更新时间戳而非重复保存

### 性能优化
- 历史记录数量限制：最多保存50条记录
- 自动渲染节流：输入停止1秒后才渲染
- 图片生成使用 `html2canvas` 库，质量设置为2x

### 兼容性
- 现代浏览器支持（Chrome、Firefox、Safari、Edge）
- 移动端浏览器支持
- 需要支持 `localStorage` 和 `Clipboard API`

## 📱 移动端使用

### 布局变化
- 屏幕宽度 ≤ 768px：切换为单列布局
- 历史记录按钮移至标题下方
- 编辑器和预览面板垂直排列

### 操作优化
- 按钮大小增大，便于触屏操作
- 状态消息位置调整，避免遮挡内容
- 全屏模式适配移动端屏幕

## 🗂️ 数据格式

### 历史记录数据结构
```json
{
  "id": "1640995200000",
  "title": "用户登录流程图",
  "code": "graph TD\n    A[开始] --> B{验证}",
  "timestamp": "2023-12-31T16:00:00.000Z",
  "preview": "graph TD\\n    A[开始] --> B{验证}..."
}
```

### 导出数据格式
```json
{
  "version": "1.0",
  "exportDate": "2023-12-31T16:00:00.000Z",
  "count": 10,
  "data": [...]
}
```

## 🚀 部署说明

1. 将 `mermaid-history.html` 文件放置在 web 服务器目录
2. 确保可以访问 CDN 资源：
   - Mermaid.js: `https://cdn.jsdelivr.net/npm/mermaid@10.9.1/dist/mermaid.min.js`
   - html2canvas: `https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js`
3. 在浏览器中访问该文件即可使用

## 🔍 测试

访问 `test-mermaid-history.html` 查看功能测试页面和使用说明。

## 📝 更新日志

### v3.0 - 历史记录版本
- ✨ 新增：完整的历史记录管理功能
- ✨ 新增：手机端响应式适配
- ✨ 新增：键盘快捷键支持
- ✨ 新增：自动渲染功能
- ✨ 新增：历史记录导出功能
- 🐛 修复：移动端显示问题
- 💄 优化：界面交互体验

## 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个工具！

## 📄 许可证

MIT License
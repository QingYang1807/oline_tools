<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>文件内容对比工具 · 工具箱</title>
  <link rel="stylesheet" href="../../assets/css/style.css">
  <meta name="color-scheme" content="light dark">
  <style>
    .diff-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .input-section {
      display: flex;
      flex-direction: column;
    }
    
    .input-section label {
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--text-color);
    }
    
    .input-section textarea {
      width: 100%;
      min-height: 300px;
      padding: 12px;
      border: 2px solid var(--border-color);
      border-radius: 8px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.5;
      resize: vertical;
      background: var(--bg-color);
      color: var(--text-color);
    }
    
    .input-section textarea:focus {
      outline: none;
      border-color: var(--accent-color);
    }
    
    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.2s ease;
    }
    
    .btn-primary {
      background: var(--accent-color);
      color: white;
    }
    
    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }
    
    .btn-secondary {
      background: var(--border-color);
      color: var(--text-color);
    }
    
    .btn-secondary:hover {
      background: var(--border-hover);
    }
    
    .diff-result {
      background: var(--bg-color);
      border: 2px solid var(--border-color);
      border-radius: 8px;
      padding: 20px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 14px;
      line-height: 1.6;
      white-space: pre-wrap;
      overflow-x: auto;
    }
    
    .diff-line {
      padding: 2px 8px;
      margin: 1px 0;
      border-radius: 3px;
    }
    
    .diff-added {
      background: rgba(76, 175, 80, 0.2);
      color: #4caf50;
      border-left: 3px solid #4caf50;
    }
    
    .diff-removed {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border-left: 3px solid #f44336;
      text-decoration: line-through;
    }
    
    .diff-unchanged {
      color: var(--text-color);
    }
    
    .diff-info {
      background: rgba(33, 150, 243, 0.1);
      color: #2196f3;
      border-left: 3px solid #2196f3;
      font-style: italic;
    }
    
    .stats {
      display: flex;
      gap: 20px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }
    
    .stat-item {
      background: var(--bg-color);
      border: 1px solid var(--border-color);
      border-radius: 6px;
      padding: 12px 16px;
      text-align: center;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: bold;
      color: var(--accent-color);
    }
    
    .stat-label {
      font-size: 12px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .file-input {
      display: none;
    }
    
    .file-label {
      display: inline-block;
      padding: 10px 20px;
      background: var(--border-color);
      color: var(--text-color);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .file-label:hover {
      background: var(--border-hover);
    }
    
    .back-link {
      display: inline-block;
      margin-bottom: 20px;
      color: var(--accent-color);
      text-decoration: none;
      font-weight: 500;
    }
    
    .back-link:hover {
      text-decoration: underline;
    }
    
    @media (max-width: 768px) {
      .diff-container {
        grid-template-columns: 1fr;
        gap: 15px;
      }
      
      .controls {
        flex-direction: column;
      }
      
      .btn {
        width: 100%;
      }
      
      .stats {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="site-title">📊 文件内容对比工具</h1>
      <p class="site-subtitle">快速比较两个文本内容的差异，支持高亮显示</p>
    </div>
  </header>

  <main class="container">
    <a href="../index.html" class="back-link">← 返回工具箱</a>
    
    <div class="diff-container">
      <div class="input-section">
        <label for="text1">原始文本 (左侧)</label>
        <textarea id="text1" placeholder="请输入或粘贴原始文本内容..."></textarea>
        <input type="file" id="file1" class="file-input" accept=".txt,.md,.js,.py,.java,.cpp,.c,.html,.css,.xml,.json">
        <label for="file1" class="file-label">选择文件</label>
      </div>
      
      <div class="input-section">
        <label for="text2">对比文本 (右侧)</label>
        <textarea id="text2" placeholder="请输入或粘贴需要对比的文本内容..."></textarea>
        <input type="file" id="file2" class="file-input" accept=".txt,.md,.js,.py,.java,.cpp,.c,.html,.css,.xml,.json">
        <label for="file2" class="file-label">选择文件</label>
      </div>
    </div>
    
    <div class="controls">
      <button class="btn btn-primary" onclick="compareTexts()">开始对比</button>
      <button class="btn btn-secondary" onclick="clearAll()">清空所有</button>
      <button class="btn btn-secondary" onclick="swapTexts()">交换文本</button>
      <button class="btn btn-secondary" onclick="loadSampleData()">加载示例数据</button>
    </div>
    
    <div class="stats" id="stats" style="display: none;">
      <div class="stat-item">
        <div class="stat-number" id="addedLines">0</div>
        <div class="stat-label">新增行数</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="removedLines">0</div>
        <div class="stat-label">删除行数</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="totalLines">0</div>
        <div class="stat-label">总行数</div>
      </div>
      <div class="stat-item">
        <div class="stat-number" id="similarity">0%</div>
        <div class="stat-label">相似度</div>
      </div>
    </div>
    
    <div class="diff-result" id="diffResult" style="display: none;"></div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <span>© <span id="year"></span> 工具箱</span>
    </div>
  </footer>

  <script>
    // 文件上传处理
    document.getElementById('file1').addEventListener('change', function(e) {
      handleFileUpload(e.target.files[0], 'text1');
    });
    
    document.getElementById('file2').addEventListener('change', function(e) {
      handleFileUpload(e.target.files[0], 'text2');
    });
    
    function handleFileUpload(file, textareaId) {
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById(textareaId).value = e.target.result;
      };
      reader.readAsText(file);
    }
    
    // 文本对比功能
    function compareTexts() {
      const text1 = document.getElementById('text1').value;
      const text2 = document.getElementById('text2').value;
      
      if (!text1.trim() && !text2.trim()) {
        alert('请至少输入一些文本内容');
        return;
      }
      
      const diff = generateDiff(text1, text2);
      displayDiff(diff);
      updateStats(diff);
      
      document.getElementById('diffResult').style.display = 'block';
      document.getElementById('stats').style.display = 'flex';
    }
    
    function generateDiff(text1, text2) {
      const lines1 = text1.split('\n');
      const lines2 = text2.split('\n');
      
      const diff = [];
      let i = 0, j = 0;
      
      while (i < lines1.length || j < lines2.length) {
        if (i < lines1.length && j < lines2.length && lines1[i] === lines2[j]) {
          diff.push({ type: 'unchanged', line: lines1[i], lineNum1: i + 1, lineNum2: j + 1 });
          i++;
          j++;
        } else if (i < lines1.length && (j >= lines2.length || lines1[i] !== lines2[j])) {
          diff.push({ type: 'removed', line: lines1[i], lineNum1: i + 1, lineNum2: null });
          i++;
        } else if (j < lines2.length && (i >= lines1.length || lines1[i] !== lines2[j])) {
          diff.push({ type: 'added', line: lines2[j], lineNum1: null, lineNum2: j + 1 });
          j++;
        }
      }
      
      return diff;
    }
    
    function displayDiff(diff) {
      const resultDiv = document.getElementById('diffResult');
      let html = '';
      
      diff.forEach(item => {
        let lineClass = 'diff-line ';
        let lineInfo = '';
        
        switch (item.type) {
          case 'added':
            lineClass += 'diff-added';
            lineInfo = `+${item.lineNum2}`;
            break;
          case 'removed':
            lineClass += 'diff-removed';
            lineInfo = `-${item.lineNum1}`;
            break;
          case 'unchanged':
            lineClass += 'diff-unchanged';
            lineInfo = ` ${item.lineNum1}:${item.lineNum2}`;
            break;
        }
        
        html += `<div class="${lineClass}">${lineInfo} ${escapeHtml(item.line)}</div>`;
      });
      
      resultDiv.innerHTML = html;
    }
    
    function updateStats(diff) {
      const added = diff.filter(item => item.type === 'added').length;
      const removed = diff.filter(item => item.type === 'removed').length;
      const unchanged = diff.filter(item => item.type === 'unchanged').length;
      const total = diff.length;
      
      const similarity = total > 0 ? Math.round((unchanged / total) * 100) : 0;
      
      document.getElementById('addedLines').textContent = added;
      document.getElementById('removedLines').textContent = removed;
      document.getElementById('totalLines').textContent = total;
      document.getElementById('similarity').textContent = similarity + '%';
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function clearAll() {
      document.getElementById('text1').value = '';
      document.getElementById('text2').value = '';
      document.getElementById('diffResult').style.display = 'none';
      document.getElementById('stats').style.display = 'none';
    }
    
    function swapTexts() {
      const text1 = document.getElementById('text1').value;
      const text2 = document.getElementById('text2').value;
      
      document.getElementById('text1').value = text2;
      document.getElementById('text2').value = text1;
    }
    
    function loadSampleData() {
      const sample1 = `function calculateSum(a, b) {
    return a + b;
}

function multiply(a, b) {
    return a * b;
}

// 主函数
function main() {
    console.log("Hello World");
}`;

      const sample2 = `function calculateSum(a, b) {
    // 添加参数验证
    if (typeof a !== 'number' || typeof b !== 'number') {
        throw new Error('参数必须是数字');
    }
    return a + b;
}

function multiply(a, b) {
    return a * b;
}

function divide(a, b) {
    if (b === 0) {
        throw new Error('除数不能为零');
    }
    return a / b;
}

// 主函数
function main() {
    console.log("Hello World");
    console.log("Welcome to our app");
}`;

      document.getElementById('text1').value = sample1;
      document.getElementById('text2').value = sample2;
    }
    
    // 设置年份
    document.getElementById('year').textContent = new Date().getFullYear();
    
    // 添加快捷键支持
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch (e.key) {
          case 'Enter':
            e.preventDefault();
            compareTexts();
            break;
          case 's':
            e.preventDefault();
            swapTexts();
            break;
        }
      }
    });
  </script>
</body>
</html>
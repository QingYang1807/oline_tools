<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Markdown 编辑器功能测试</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
    .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
    .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    button { padding: 8px 16px; margin: 5px; border: none; border-radius: 4px; background: #007bff; color: white; cursor: pointer; }
    button:hover { background: #0056b3; }
  </style>
</head>
<body>
  <h1>🧪 Markdown 编辑器功能测试</h1>
  
  <div class="test-section">
    <h2>📋 测试项目</h2>
    <p>点击下面的按钮来测试 Markdown 编辑器的各项功能：</p>
    
    <button onclick="testBasicFunctionality()">测试基本功能</button>
    <button onclick="testMarkdownParsing()">测试 Markdown 解析</button>
    <button onclick="testLocalStorage()">测试本地存储</button>
    <button onclick="testPDFExport()">测试 PDF 导出</button>
    <button onclick="runAllTests()">运行所有测试</button>
  </div>

  <div id="testResults"></div>

  <div class="test-section">
    <h2>🔗 相关链接</h2>
    <ul>
      <li><a href="tools/markdown-editor.html" target="_blank">打开 Markdown 编辑器</a></li>
      <li><a href="index.html">返回工具箱首页</a></li>
      <li><a href="demo-markdown.md" target="_blank">查看演示文档</a></li>
    </ul>
  </div>

  <script>
    let testResults = [];

    function addTestResult(testName, success, message) {
      const result = { name: testName, success, message, timestamp: new Date() };
      testResults.push(result);
      
      const resultsDiv = document.getElementById('testResults');
      const resultDiv = document.createElement('div');
      resultDiv.className = `test-result ${success ? 'success' : 'error'}`;
      resultDiv.innerHTML = `
        <strong>${testName}</strong>: ${success ? '✅ 通过' : '❌ 失败'}
        <br><small>${message}</small>
        <br><small>时间: ${result.timestamp.toLocaleTimeString()}</small>
      `;
      resultsDiv.appendChild(resultDiv);
    }

    function testBasicFunctionality() {
      try {
        // 测试基本 DOM 操作
        const testDiv = document.createElement('div');
        testDiv.textContent = '测试内容';
        document.body.appendChild(testDiv);
        document.body.removeChild(testDiv);
        
        addTestResult('基本 DOM 操作', true, 'DOM 操作正常');
      } catch (error) {
        addTestResult('基本 DOM 操作', false, error.message);
      }
    }

    function testMarkdownParsing() {
      try {
        // 检查是否加载了 Marked 库
        if (typeof marked !== 'undefined') {
          const testMarkdown = '**粗体** *斜体*';
          const result = marked.parse(testMarkdown);
          
          if (result.includes('<strong>粗体</strong>') && result.includes('<em>斜体</em>')) {
            addTestResult('Markdown 解析', true, 'Marked.js 库加载正常，解析功能正常');
          } else {
            addTestResult('Markdown 解析', false, '解析结果不符合预期');
          }
        } else {
          addTestResult('Markdown 解析', false, 'Marked.js 库未加载');
        }
      } catch (error) {
        addTestResult('Markdown 解析', false, error.message);
      }
    }

    function testLocalStorage() {
      try {
        const testKey = 'test_markdown_editor';
        const testValue = '测试数据';
        
        // 测试写入
        localStorage.setItem(testKey, testValue);
        
        // 测试读取
        const readValue = localStorage.getItem(testKey);
        
        // 清理测试数据
        localStorage.removeItem(testKey);
        
        if (readValue === testValue) {
          addTestResult('本地存储', true, 'localStorage 读写功能正常');
        } else {
          addTestResult('本地存储', false, '读取的数据与写入的不匹配');
        }
      } catch (error) {
        addTestResult('本地存储', false, error.message);
      }
    }

    function testPDFExport() {
      try {
        // 检查是否加载了 html2pdf 库
        if (typeof html2pdf !== 'undefined') {
          addTestResult('PDF 导出库', true, 'html2pdf.js 库加载正常');
        } else {
          addTestResult('PDF 导出库', false, 'html2pdf.js 库未加载');
        }
      } catch (error) {
        addTestResult('PDF 导出库', false, error.message);
      }
    }

    function runAllTests() {
      // 清空之前的结果
      document.getElementById('testResults').innerHTML = '';
      testResults = [];
      
      // 运行所有测试
      testBasicFunctionality();
      testMarkdownParsing();
      testLocalStorage();
      testPDFExport();
      
      // 显示测试总结
      setTimeout(() => {
        const totalTests = testResults.length;
        const passedTests = testResults.filter(r => r.success).length;
        const failedTests = totalTests - passedTests;
        
        const summaryDiv = document.createElement('div');
        summaryDiv.className = 'test-result info';
        summaryDiv.innerHTML = `
          <h3>📊 测试总结</h3>
          <p>总测试数: ${totalTests}</p>
          <p>通过: ${passedTests} ✅</p>
          <p>失败: ${failedTests} ❌</p>
          <p>成功率: ${Math.round((passedTests / totalTests) * 100)}%</p>
        `;
        
        document.getElementById('testResults').appendChild(summaryDiv);
      }, 100);
    }

    // 页面加载完成后自动运行基本测试
    window.addEventListener('load', () => {
      addTestResult('页面加载', true, '测试页面加载完成');
    });
  </script>
</body>
</html>